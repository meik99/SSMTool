<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <title>SSM Tool</title>

    <link rel="stylesheet" href="css/style.css"/>
</head>
<body>
    <div class="container">
        <div class="project-outline-container" id="project-outline-container">
            <div class="project-outline" id="projectOutlinePanel">
                <div class="project-outline-title">
                    <h2>Project</h2>
                </div>
                <div class="project-outline-button-container">
                    <button class="project-outline-button">+</button>
                    <button class="project-outline-button">-</button>
                </div>
            </div>
        </div>
        <div class="diagram-container" id="diagram-container">
            <div class="diagram-editor" id="diagram-editor">
                <textarea class="diagram-editor-textarea" id="diagram-editor-textarea" wrap="hard"
                    placeholder="Script your diagram" autofocus>!#</textarea>
            </div>
            <div class="diagram-renderer" id="diagram-renderer">
                <canvas class="diagram-renderer-canvas"></canvas>
            </div>
        </div>
    </div>
<script>
    const {ipcRenderer} = require("electron");
    const split = require("split.js");
    const Lexer = require("./interpreter/Lexer");
    const Scanner = require("./interpreter/Scanner");

    window.onresize = function() {
        setPageSize();
        focusEditor();
    };

    function setPageSize() {
        ipcRenderer.send("window", "send");

        ipcRenderer.on("window", function (event, args) {
            if(args && args.height) {
                var projectOutlinePanel = document.getElementById("projectOutlinePanel");

                projectOutlinePanel.style.height = (args.height - 2) + "px";
            }
        });
    }

    function focusEditor(){
        var textarea = document.getElementById("diagram-editor-textarea");
        var textLength = textarea.value.length;

        textarea.focus();
    }

    function setupEventHandler(){
        var textEditor = document.getElementById("diagram-editor-textarea");

        textEditor.onkeyup = function(){
            var lexer = new Lexer.Lexer(
                new Scanner.Scanner(
                    textEditor.value
                )
            );
            lexer.analyse();
        };
    }

    setPageSize();
    setupEventHandler();
    split(["#diagram-editor", "#diagram-renderer"], {
    });
</script>
</body>
</html>